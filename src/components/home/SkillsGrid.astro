---
import { cn } from "../../utils";
import { skills } from "../../data/skills";
import { randomUUID } from "node:crypto";

const {
	class: className,
	collapsible = true,
	collapsedMaxHeight = "18rem",
	toggleId: toggleIdProp,
} = Astro.props;

const toggleId = toggleIdProp ?? `skills-toggle-${randomUUID()}`;
---

<section class={cn(className, "relative")}> 
	<div class="mb-12 text-center">
		<h2 class="text-3xl md:text-4xl font-black mb-4">
			Skills <span class="text-pink-500">&amp; Tools</span>
		</h2>
		<p class="text-base text-gray-400 max-w-2xl mx-auto">
			Technologies I use regularly across web, mobile, and cloud.
		</p>
	</div>

	<div class="px-4 md:px-0">
		{collapsible ? (
			<div class="relative" style={`--skills-max-h: ${collapsedMaxHeight};`}>
				<input id={toggleId} type="checkbox" class="peer sr-only" />

				<div
					class="
						transition-[max-height] duration-500 ease-in-out motion-reduce:transition-none
						max-h-(--skills-max-h) overflow-hidden
						peer-checked:max-h-none
						sm:max-h-none sm:overflow-visible
					"
				>
					<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-5">
						{skills.map((skill) => (
							<div class="group rounded-xl border border-gray-800 bg-gray-900/50 hover:border-pink-500/40 hover:bg-gray-900 transition-colors p-4 flex flex-col items-center justify-center text-center">
								<div class="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center">
									<img
										src={skill.iconUrl}
										alt={`${skill.name} logo`}
										loading="lazy"
										decoding="async"
										class="w-full h-full object-contain opacity-90 group-hover:opacity-100 transition-opacity"
									/>
								</div>
								<div class="mt-3 text-xs md:text-sm text-gray-300 group-hover:text-white transition-colors">
									{skill.name}
								</div>
							</div>
						))}
					</div>
				</div>

				<div
					class="
						sm:hidden pointer-events-none absolute inset-x-0 bottom-0 h-16
						
						transition-opacity duration-200 motion-reduce:transition-none
						peer-checked:opacity-0
					"
					aria-hidden="true"
				/>

				<label
					for={toggleId}
					class="
						sm:hidden mt-6 mx-auto w-fit
						flex items-center gap-2 rounded-full border border-gray-800
						bg-gray-900/60 px-4 py-2 text-sm text-gray-200
						hover:border-pink-500/40 hover:bg-gray-900 transition-colors
						cursor-pointer select-none
						peer-checked:hidden
					"
				>
					<span>Show more</span>
					<svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
						<path
							fill-rule="evenodd"
							d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
							clip-rule="evenodd"
						/>
					</svg>
				</label>

				<label
					for={toggleId}
					class="
						sm:hidden mt-6 mx-auto w-fit
						hidden peer-checked:flex items-center gap-2 rounded-full border border-gray-800
						bg-gray-900/60 px-4 py-2 text-sm text-gray-200
						hover:border-pink-500/40 hover:bg-gray-900 transition-colors
						cursor-pointer select-none
					"
				>
					<span>Show less</span>
					<svg class="h-4 w-4 rotate-180" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
						<path
							fill-rule="evenodd"
							d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
							clip-rule="evenodd"
						/>
					</svg>
				</label>
			</div>
		) : (
			<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-5">
				{skills.map((skill) => (
					<div class="group rounded-xl border border-gray-800 bg-gray-900/50 hover:border-pink-500/40 hover:bg-gray-900 transition-colors p-4 flex flex-col items-center justify-center text-center">
						<div class="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center">
							<img
								src={skill.iconUrl}
								alt={`${skill.name} logo`}
								loading="lazy"
								decoding="async"
								class="w-full h-full object-contain opacity-90 group-hover:opacity-100 transition-opacity"
							/>
						</div>
						<div class="mt-3 text-xs md:text-sm text-gray-300 group-hover:text-white transition-colors">
							{skill.name}
						</div>
					</div>
				))}
			</div>
		)}
	</div>
</section>
